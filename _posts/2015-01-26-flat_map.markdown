---
title: Enumerable#flat_map
image: /assets/flat_map.jpg
---
В Руби 1.9.2 появился класный метод `flat_map` [<i class="fa fa-external-link"></i>](http://ruby-doc.org/core-2.1.0/Enumerable.html#method-i-flat_map),
который я незаслуженно обходил стороной.

Он делает все тоже самое, что обычный `map`, только объединяет возвращаемые значения
не в массив, а друг с другом. Официальная документация описывает это так:

``` ruby
[1, 2, 3, 4].flat_map { |e| [e, -e] } #=> [1, -1, 2, -2, 3, -3, 4, -4]
[[1, 2], [3, 4]].flat_map { |e| e + [100] } #=> [1, 2, 100, 3, 4, 100]
```

В Рейлс же этот метод можно использовать вот так:

``` ruby
class Planet < ActiveRecord::Base
  has_many :countries
end

class Country < ActiveRecord::Base
  has_many :cities
end

class City < ActiveRecord::Base
end

Planet.
  includes(:countries => :cities).
  flat_map(&:countries).flat_map(&:cities)
```

Руби - гениальный язык!
