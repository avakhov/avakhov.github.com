---
title: Ember - 3. REST
image: /assets/meeio.jpg
---
Давно не брал я в руки вима, вот беру и снова беру. Недавно узнал, что есть устойчивая аббревиатура MEAN
для стека из монго, експресса, ангуляра и ноды.
У нас ембер вместо ангуляра, меняем ноду на iojs, работаем в стеке MEEIO. 

В прошлом выпуске [<i class="fa fa-external-link"></i>](/blog/2015/01/29/ember-2-fire/index.html)
мы сделали буковку R из CRUD для постов, сегодня доделаем все остальные буквы. Обновляем рауты:

``` javascript
Router.map(function() {
  this.route('posts/index', {path: '/'});
  this.route('posts/new', {path: '/posts/new'});
  this.route('posts/show', {path: '/posts/:id'});
  this.route('posts/edit', {path: '/posts/:id/edit'});
});
```

На главной странице добавляем ссылку на создание нового поста (`app/templates/posts/index.hbs`):

``` handlebars
{% raw %}
<p>{{#link-to "posts/new"}}New Post{{/link-to}}</p>
{% endraw %}
```

Делаем раут для `new` (`app/routes/posts/new.js`):

``` javascript
export default Ember.Route.extend({
  model: function() {
    return this.store.createRecord('post');
  },

  deactivate: function() {
    if (this.controller.get("model.isNew")) {
      this.controller.get("model").rollback();
    }
  }
});
```

Обратите внимание на метод `deactivate`. Я не знаю насколько это стандартный прием, придумал его из
головы. В прошлом выпуске мы обсуждали, что ембер-store - это некоторая сущность, которая должна
синхронизироваться с сервером. `createRecord` не синхронизирует запись с сервером, однако создает его в
сторе. И если вы откажитесь от сохранения записи и выйдите через меню на главную страницу, то пустая
запись будет в вашем списке. Чтобы этого не произошло и добавил ролбек на не сохрненную модель.

В форме вешаем на кнопку экшен (`app/templates/posts/_form.hbs`):

``` handlebars
{% raw %}
  <button type="submit" class="btn btn-default" {{action "save"}}>Save</button>
{% endraw %}
```

Который обрабатываем в контроллере (`app/controllers/posts/new.js`):

``` javascript
import Ember from 'ember';

export default Ember.ObjectController.extend({
  actions: {
    save: function() {
      var me = this;
      var model = this.model;
      model.save().then(function() {
        me.transitionToRoute("posts/show", model);
      });
    }
  }
});
```

Таким образом реализовали C. Остальные буквы легко сделать по аналогии.

* Изменения - [https://github.com/avakhov/ember-demo/compare](https://github.com/avakhov/ember-demo/compare/52b5925aa6a72726998bfd5d7600f49ce83e2ff2...2212d524f6b41407e468830fe8114260e117f4cc)
* Приложение на хероку - [http://ember-demo.herokuapp.com](http://ember-demo.herokuapp.com)
