<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Alexey Vakhov</title>
    <description>Блог, милый блог. Новая история каждый будний день.</description>
    <link>http://vakhov.me</link>
    <atom:link href="http://vakhov.me/atom.xml" rel="self" type="application/rss+xml" />
    
      <item>
        <title>Бэкапы</title>
        <description>
          
          &lt;p&gt;Сам факт бэкапов (особенно, восстанавливаемость которых каких-то образом проверятся), в некоторых
дискуссиях
преподносится, как высшая степень профессионализма. Конечно бэкапы это хорошо, но классических
&lt;code&gt;pg_dump-&lt;/code&gt;, &lt;code&gt;WAL-логов&lt;/code&gt; или каких-то подобных бинарей, даже разложенных в географически удаленные точки,
в идеальном мире недостаточно.&lt;/p&gt;

&lt;p&gt;Классно было бы время от времени подниматься с бэкапа, полностью зарубая
старый сторадж. Тогда архив, с которого мы поднялись, был бы эталонным для точки поднятия. Если продакшен
работает дальше, значит мы владеем реальным дампом продакшена на тот момент.
В гуглах всяких насколько понимаю как-то так и делают, постоянно поднимая какие-то данные из бэкапов,
но вот какого-то рабочего подхода для маленьких и гордых пока не встречал.&lt;/p&gt;

&lt;p&gt;В этом плане я в восторге от гита. В сущности IT-ценность стартапа - это код и базы. Код в гите со всей историей раскладывается в так много точек, что его сложно потерять целиком, а вот с базами так пока не
получается. Поэтому битва с бэкапами продолжается и выиграть ее нельзя, задача - все время играть в ничью.&lt;/p&gt;

        </description>
        <pubDate>Tue, 07 Mar 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/03/07/backups/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/03/07/backups/index.html</guid>
      </item>
    
      <item>
        <title>Теги в ансибле</title>
        <description>
          
          &lt;p&gt;Когда в ансибл настраиваешь бокс и запускаешь &lt;code&gt;ansible-playbook the-server.yml&lt;/code&gt; раз за разам,
то обычно хочется запускать только какой-то кусочек файла, я знаю два способа: колхозный и
красивый.&lt;/p&gt;

&lt;p&gt;Колхозный - просто комментим то, что не нужно запускать, главное не забыть раскоментить
перед пушем обратно. В виме у меня компанда &lt;code&gt;gc&lt;/code&gt; почему-то комментирует или раскомментирует
более менее правильно любой фрагмент кода на любом языке. Видимо это плагин какой-то, так как пальцы
помнят, а разум нет.&lt;/p&gt;

&lt;p&gt;Красивый - на нужные констукции повесить тег, например так:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p-Indicator&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;manage_user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;{admin_users}&amp;quot;&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p-Indicator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p-Indicator&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;и вызывать &lt;code&gt;ansible-playbook the-server.yml --tags keys&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Во время разработки я обычно использую
колхозный способ (все мои дедушки, бабушки и пра- из крестьян), а вот, например, в новых репозитариях
команда &lt;code&gt;ansible-playbook *.yml --tags keys&lt;/code&gt; как раз обновляет все ключи на всех серверах, если нужно
дать доступ коллеге или наоборот забрать. В принципе возможна ситуация, когда в одной подсети может быть разный
доступ к разным серверам и данное решение DRY.&lt;/p&gt;

        </description>
        <pubDate>Mon, 06 Mar 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/03/06/atag/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/03/06/atag/index.html</guid>
      </item>
    
      <item>
        <title>Лоулоад</title>
        <description>
          
          &lt;p&gt;Прелесть хайлоада заключается в том, что у сервиса много запросов и они вам пытаются устроить DoS, то есть
отказ от обслуживания, забивая канал, базы, провоцируя редкие случая и так далее, а мы,
чаще мужчины, нередко бородатые, соответственно с этой ситуацией боремся на регулярной основе.
Это реально круто, но жизнь может вызвать DoS гораздо большим количеством способов и без большой нагрузки.&lt;/p&gt;

&lt;p&gt;Первый DoS у меня был когда я выдал емейл и все остальные доступы примерно тридцатому сотруднику.
Это не фига не весело сбрасывать пароль человеку, которому сбрасывал уже утром, и который
очень хороший человек, но немного такой, не собранный.&lt;/p&gt;

&lt;p&gt;Тимлидерский DoS возник, когда на доске закончился сотый магнит для примагничивания листиков с задачами и
пришлось прикреплять по несколько к одному (а сама доска был ответ на DoS ситуации, когда 
было понятно, что каждый сотрудник усердно работает весь день, но вот только над чем?)&lt;/p&gt;

&lt;p&gt;В прошлой жизни, да и в этой жизни, я знаю людей, которые, дернув кофейку после 6 часов
совещаний, радостно приступают к разобру накопившейся почты. Поэтому DoS совещаний я, пожалуй,
избежал, жестко стараясь слинять абсолютно с каждого совещания на которое позвали, чисто на рефлексах.
Также избежал
DoS почты, дисциплинированно отписываясь от каждого треда в который попал, дожидаясь меншена, который
затянет обратно.&lt;/p&gt;

&lt;p&gt;Мне кажется сегодня железо давно не самое слабое место IT-продукта, если нода держит 4000 открытых
веб сокетов с одного сервера, то человек, а тем более отношения между людьми, держат на порядки меньше
и ломаются гораздо быстрее. Современная разработка - это изучение и поддержка как раз вот этого малого
трафика и малых нагрузок. А железо, хм, просто купите побольше.&lt;/p&gt;

        </description>
        <pubDate>Fri, 03 Mar 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/03/03/lowload/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/03/03/lowload/index.html</guid>
      </item>
    
      <item>
        <title>Хайлоад</title>
        <description>
          
          &lt;p&gt;Несколько лет назад я постулировал для себя, что хайлоад - это  1000 запросов в секунду.
500 - полхайлоада, 800 - три четверти
хайлоада, арифметика простая. Я даже написал шуточный пост для друзей, не хотел его публиковать,
но все сказали, что нормально, вот он по &lt;a href=&quot;/18plus.html&quot;&gt;ссылке&lt;/a&gt;, можете прочитать.&lt;/p&gt;

&lt;p&gt;Но самое забавное, что как только проект достигает некоторых высот, инженеры делают все,
чтобы нагрузкой не работать. Разработчикам создается безопасная среда, в которой можно спокойно пилить
бизнес-логику. Опсы тоже придумывают свой набор правил в стиле &amp;quot;работает не трогает&amp;quot;.
В принципе мне кажется большинство архитектур нагруженных систем строится по принципу - взять
ту архитектуру, в которой сервис принял трафик и по возможности не трогать
(естественно я говорю про стартапы, которые
пилят-пилят на коленке и во, поперло. Если создается система под заказ, в которой одно из требований
- нагрузка, ну например, не знаю продажа билетов по всей стране, то там конечно берутся
какие-то проверенные архитектурные решения или, что чаще, адаптируется готовая
система).&lt;/p&gt;

&lt;p&gt;На прошлой работе я даже видел настоящий памятник хайлоаду, сервис в который не комитили 7 лет, а он
принимал на себя практически весь биржевой трафик, который обрабатывался в компании. Насколько я помню
это был какой-то траслятор из одного формата в другой. Он был настолько нагруженный, что тот кто мог
туда что-то закомитить, не хотел, а кто хотел, того не пускали.&lt;/p&gt;

&lt;p&gt;Хайлоад, это перефразируя советский
анекдот про дефецит, объективно большие нагрузки, данные в ощущениях, но не нам.
А завтра я хочу написать
про лоулоад, который был объективен, дан в ощущениях и лично мне.&lt;/p&gt;

        </description>
        <pubDate>Thu, 02 Mar 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/03/02/highload/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/03/02/highload/index.html</guid>
      </item>
    
      <item>
        <title>Скелет презентации</title>
        <description>
          
          &lt;p&gt;Я сейчас активно готовлюсь к ДевОпсДейс с помощью прекрасной книги по презентациям от
Глеба Шулишова &lt;a href=&quot;http://www.prostopreza.ru/pages/book&quot;&gt;Скелет презентации&lt;/a&gt;. Она небольшая и
мне кажется ее стоит почитать, даже если вам не нужно в ближайшее время делать никаких презентаций вообще.&lt;/p&gt;

&lt;p&gt;Глеб делит презентации на два типа:&lt;/p&gt;

&lt;p&gt;&lt;img src=/18/Graphic2.png&gt;&lt;/p&gt;

&lt;p&gt;Я конечно буду стараться сделать офигенную презентацию, но так как Новый Год в моей жизни пока бывает
чаще публичных выступлений, то как минумум ставлю задачу заглянуть в бизнес-класс, за вот эту занавесочку
и стибрить там вилку и плед.&lt;/p&gt;

        </description>
        <pubDate>Wed, 01 Mar 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/03/01/gleb/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/03/01/gleb/index.html</guid>
      </item>
    
      <item>
        <title>Токены в API</title>
        <description>
          
          &lt;p&gt;Обычно встречаются два способа подписывать API-запросы, прямо в урл &lt;code&gt;?token=abc&lt;/code&gt;, либо
в специальных заголовках к запросу. Я разницы между ними раньше не видел, но сейчас считаю, что
с заголовком лучше, так как иначе токен будет лежать в логах веб-сервера и сервера приложения, что
в общем случае не хорошо.&lt;/p&gt;

        </description>
        <pubDate>Tue, 28 Feb 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/02/28/token/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/02/28/token/index.html</guid>
      </item>
    
      <item>
        <title>ping 10.4</title>
        <description>
          
          &lt;p&gt;Случайной опечаткой выяснил, что &lt;code&gt;ping 10.0.04&lt;/code&gt; это тоже самое, что &lt;code&gt;ping 10.0.0.4&lt;/code&gt; (повторяется
на маке и на убунту). Немного поиграв, нашел, что &lt;code&gt;ping 10.4&lt;/code&gt; то же самое! Наверняка
где-то в спецификациях есть объяснение этому факту, но я не знаю.&lt;/p&gt;

&lt;p&gt;Это просто забавная штука, а есть вещи еще
менее очевидные, которые можно, либо получить от опытных товарищей, либо набить шишку самому:
например, не давать
для VPN-подсетей адреса а-ля &lt;code&gt;192.168.1.*&lt;/code&gt;, распространенные в бытовых раутерах, чтобы не
получить лишних проблем.&lt;/p&gt;

        </description>
        <pubDate>Mon, 27 Feb 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/02/27/ping/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/02/27/ping/index.html</guid>
      </item>
    
      <item>
        <title>Няшно</title>
        <description>
          
          &lt;p&gt;В одной книге был приведен эксперимент (сорри, что не помню книг и авторов, так
как записывать цитаты я еще не дорос, а запоминать - почему-то часто не запоминается), когда
людям предлагалось проделать какую-то осмысленную операцию на красивом, &amp;quot;дизайнерском&amp;quot;
банкомате и на страшненьком. На красивом получалось побыстрее, но самое важное, что
люди, не считали, что потеряли время! То
есть они получили удовольствие, делая какую-то скучную финансовую операцию!&lt;/p&gt;

&lt;p&gt;Мне кажется это очень важный фактором в современной работе. В принципе любой софт
сейчас хорош, но если есть возможность выбирать - нужно брать красивый. Тогда время,
проведенное за решением задач, будет одновременно приятным и полезным.&lt;/p&gt;

&lt;p&gt;Например, я очень люблю терраформ + ансибл (когда роли чистые). Мы храним
инфраструктуры изолированно, поэтому в каждом проекте есть небольшой линейный списочек боксов.
Можно
переименовать файл &lt;code&gt;dev01.tf =&amp;gt; dev01.tf.b&lt;/code&gt;, &lt;code&gt;terraform apply&lt;/code&gt; - сервер удалится,
&lt;code&gt;dev01.tf.b =&amp;gt; dev01.tf&lt;/code&gt;, &lt;code&gt;terraform apply&lt;/code&gt;, &lt;code&gt;ansible-playbook dev.yml&lt;/code&gt; - сервер создастся и
запровизится.
Когда все токены настроены, то такой процесс отладки новой роли, не сложный в целом, удивительно
приятный, чистый IT-дзен.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/18/vim.png&quot;&gt;&lt;/p&gt;

        </description>
        <pubDate>Wed, 22 Feb 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/02/22/pri/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/02/22/pri/index.html</guid>
      </item>
    
      <item>
        <title>Учи.ру - Руби он Рейлс разработчик</title>
        <description>
          
          &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; реклама, за пост сказано щедрое спасибо.&lt;/p&gt;

&lt;p&gt;В рамках очередного расширения наши великолепные эйчары попросили прорекламировать ваканcию Руби он Рейлс
разработчика, что с удовольствием и делаю.
&lt;a href=&quot;https://hh.ru/vacancy/19665067&quot;&gt;Здесь можно посмотреть официальную версию&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Про социальную часть наших продуктов лучше узнать на сайте,
в разделе &lt;a href=&quot;https://uchi.ru/smi-o-nas&quot;&gt;СМИ о нас&lt;/a&gt;, 
либо зарегистрироваться на сайте и позаниматься самостоятельно, либо поинтересоваться
у детей школьного возраста из вашего окружения, возможно, они уже занимаются на Учи.ру или
принимали участие в наших онлайн-олимпиадах.&lt;/p&gt;

&lt;p&gt;Компания действительно социально заряженная, я бы об этом мог много рассказать,
но лучше опишу профиль работы с
технической точки зрения.
Прежде всего это, конечно, Рейлс, сегодня он составляет 99% нашего бэкенда (и оставшийся 1% - тоже он). Но
на другие технологии тоже смотрим очень внимательно. Мы не гонимся за самым свежим день в день,
скорее держимся во второй-третьей волне прогресса, и точно не внедряем технологий только
потому, что они модные, прикольные и у всех уже три дня в продакшене.&lt;/p&gt;

&lt;p&gt;Итак, что у нас есть:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Актуальные версии рейлс, руби, постгрес, эластик на сервере.&lt;/li&gt;
&lt;li&gt;Бутстрап, реакт, вебпак и прочее в разнообразных комбинациях, приправленные jQuery на клиенте.&lt;/li&gt;
&lt;li&gt;Потрясающие дизайнеры и иллюстраторы, профессиональные верстальщики и фронты (верстать самому можно, только если вы сами очень сильно захотите).&lt;/li&gt;
&lt;li&gt;Приличные нагрузки в 500-800 запросов в секунду на продакшенах, то есть сверхтонкие оптимизации проводить нам пока еще не нужно, но мощь трафика и размеры баз будете ощущать очень хорошо.&lt;/li&gt;
&lt;li&gt;Работа в компактных, самодостаточных командах, где вы сами выбираете уровень вовлеченности в процесс. Можно настроить продакшен самостоятельно с помощью терраформа и ансибла или же сконцентрироваться только на коде и задачах бизнеса. В рамках наших открытых уроков и мероприятий очень рекомендую сходить в школу и
посмотреть, как работает продукт в реальных условиях и кто наши пользователи.&lt;/li&gt;
&lt;li&gt;Мы продуктовая компания, у нас нет разработки &amp;quot;в стол&amp;quot; или для галочки, каждую вашу фичу увидят сотни и тысячи детей, учителей, родителей, причем очень быстро. &lt;a href=&quot;https://guides.github.com/introduction/flow/&quot;&gt;Гитхаб флоу&lt;/a&gt; великолепен! Ветка, автоматически выкатывается шот, тестирование, ревью, апрув от бизнеса, мерж и продакшен!&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Присылайте свои резюме, комментарии и вопросы
Евгении Христолюбской &lt;a href=&quot;mailto:christolubskaya@uchi.ru&quot;&gt;christolubskaya@uchi.ru&lt;/a&gt;.
Буду рад новым коллегам &lt;img class=&#39;emoji&#39; title=&#39;:cat:&#39; alt=&#39;:cat:&#39; src=&#39;https://assets.github.com/images/icons/emoji/unicode/1f431.png&#39; height=&#39;20&#39; width=&#39;20&#39; align=&#39;absmiddle&#39; /&gt; &lt;img class=&#39;emoji&#39; title=&#39;:cat:&#39; alt=&#39;:cat:&#39; src=&#39;https://assets.github.com/images/icons/emoji/unicode/1f431.png&#39; height=&#39;20&#39; width=&#39;20&#39; align=&#39;absmiddle&#39; /&gt; &lt;img class=&#39;emoji&#39; title=&#39;:cat:&#39; alt=&#39;:cat:&#39; src=&#39;https://assets.github.com/images/icons/emoji/unicode/1f431.png&#39; height=&#39;20&#39; width=&#39;20&#39; align=&#39;absmiddle&#39; /&gt;.&lt;/p&gt;

&lt;p&gt;&lt;div class=&quot;fb-share-button&quot; data-href=&quot;http://vakhov.me/blog/2017/02/21/vacancy/index.html&quot; data-layout=&quot;button_count&quot; data-size=&quot;small&quot; data-mobile-iframe=&quot;true&quot;&gt;&lt;a class=&quot;fb-xfbml-parse-ignore&quot; target=&quot;_blank&quot; href=&quot;https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fvakhov.me%2Fblog%2F2017%2F02%2F21%2Fvacancy%2Findex.html&amp;amp;src=sdkpreparse&quot;&gt;Поделиться&lt;/a&gt;&lt;/div&gt;&lt;a href=&quot;https://twitter.com/share&quot; class=&quot;twitter-share-button&quot;&gt;Tweet&lt;/a&gt;&lt;style&gt;.twitter-share-button{position:relative !important;left:10px;top:6px}&lt;/style&gt;&lt;/p&gt;

        </description>
        <pubDate>Tue, 21 Feb 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/02/21/vacancy/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/02/21/vacancy/index.html</guid>
      </item>
    
      <item>
        <title>Количество запросов</title>
        <description>
          
          &lt;p&gt;Мы перешли с заббикса на прометей несколько месяцев назад, очень-очень довольны.
Я планирую в течение месяца заопенсорсить cкрипт для графаны, который помогает
создавать и поддерживать дешборды из простого yml-описания, но пока просто пример,
как можно добавить измерение запросов в секунду:&lt;/p&gt;

&lt;p&gt;1) тюним формат NGINX-логов:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;nginx&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;nginx_http_params&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;log_format combined_plus &amp;#39;$host $remote_addr - $remote_user [$time_local] &amp;#39;&lt;/span&gt;
       &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;#39;&amp;quot;$request&amp;quot; $status $body_bytes_sent $request_time &amp;#39;&lt;/span&gt;
       &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;#39;&amp;quot;$http_referer&amp;quot; &amp;quot;$http_user_agent&amp;quot; &amp;quot;$content_type&amp;quot;&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;access_log &amp;quot;/var/log/nginx/access.log&amp;quot; combined_plus&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2) запускаем nginx-exporter (можно взять вот этот &lt;a href=&quot;https://github.com/ndiazg/nginx-prometheus-exporter&quot;&gt;ndiazg/nginx-prometheus-exporter&lt;/a&gt; за основу):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;nginx_prometheus_exporter&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;docker_container&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;nginx-prometheus-exporter&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;started&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;nginx-prometheus-exporter&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;restart_policy&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;unless-stopped&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;/var/log/nginx/access.log&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;/var/log/nginx:/var/log/nginx:ro&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;3093:3093&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3) Добавляем метрику (с помощью магического скрипта):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sum(rate(http_requests_total{job=&amp;quot;nginx&amp;quot;,vhost=&amp;quot;uchi.ru&amp;quot;}[1m])) by (instance)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;4) PROFIT:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/18/4a.png&quot;&gt;&lt;/p&gt;

        </description>
        <pubDate>Tue, 21 Feb 2017 00:00:00 +0300</pubDate>
        <link>http://vakhov.me/blog/2017/02/21/prom/index.html</link>
        <guid isPermaLink="true">http://vakhov.me/blog/2017/02/21/prom/index.html</guid>
      </item>
    
  </channel>
</rss>
