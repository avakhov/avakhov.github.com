<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Создание Edge Rails приложения</title>
    <meta name="viewport" content="width=device-width">
    <link href="/fonts/all.css" rel="stylesheet">
    <style>* { font-family: 'PT Sans' !important; }</style>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/blog.css">
  </head>
  <body>
    <div class="container">
      <div class="site">
        <div class="header">
  <h1 class="title"><a href="/">Blog</a></h1>
</div>
<h1>Создание Edge Rails приложения</h1>
<p class="meta">22 May 2012</p>

<div class="post">
<p>Если вы нашли какую-нибудь ошибку в рейлс, то нужно проверить, что ее еще не исправили в мастере.
Для этого иногда необходимо создать приложение из edge. В интернете много устаревших статей на эту тему, поэтому
сегодня расскажу, как это делаю я.</p>

<p>Простой способ, это сгенерировать пустое приложение на последней стабильной версии рейлс и в гемфайле
исправить запись с rails:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="c1"># gem &#39;rails&#39;, &#39;3.2.3&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s1">&#39;../rails&#39;</span>
</code></pre></div>
<p>Но обычно это не очень хорошо, так как версии библиотек, которые прописывает стабильная версия рейлс,
отличаются от тех, которые используются в мастере. Также могут измениться опции по умолчанию в различных конфигурационных
файлах. Поэтому приходится дополнительно вручную подправлять настройки.</p>

<p>Лучше создавать приложение прямо из edge. Для этого достаточно клонировать исходники рейлс к себе, запустить <code>bundle</code>, чтобы установить
необходимые гемы и вызвать <code>rails new</code> из исходников:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">git clone https://github.com/rails/rails
pushd rails
  bundle
popd
./rails/railties/bin/rails new demo-app --edge
</code></pre></div>
<p>Опция --edge обязательная при использовании нестабильных версий рейлс, иначе приложение создатся с еще не зарелизинными версиями
библиотек и будет не рабочим.</p>

<p>Я уже <a href="/blog/2012/04/22/rails-templates/">рассказывал</a>, как я создаю новое приложение. По аналогии я создал шаблон, для
нового edge-приложения:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">file_force</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">content</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;haml&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;therubyracer&#39;</span><span class="p">,</span> <span class="ss">platform</span><span class="p">:</span> <span class="ss">:ruby</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:assets</span>
<span class="n">gem</span> <span class="s1">&#39;rails-footnotes&#39;</span><span class="p">,</span> <span class="ss">github</span><span class="p">:</span> <span class="s1">&#39;avakhov/rails-footnotes&#39;</span><span class="p">,</span> <span class="ss">branch</span><span class="p">:</span> <span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:development</span>
<span class="n">gem</span> <span class="s1">&#39;factory_girl_rails&#39;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:test</span>
<span class="n">gem</span> <span class="s1">&#39;timecop&#39;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:test</span>
<span class="n">gem</span> <span class="s1">&#39;database_cleaner&#39;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:test</span>
<span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="o">[</span><span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>

<span class="n">file</span> <span class="s1">&#39;.rspec&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">--colour</span>
<span class="no">CODE</span>

<span class="n">file</span> <span class="s1">&#39;spec/spec_helper.rb&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">ENV[&quot;RAILS_ENV&quot;] ||= &#39;test&#39;</span>
<span class="sh">require File.expand_path(&quot;../../config/environment&quot;, __FILE__)</span>
<span class="sh">require &#39;rspec/rails&#39;</span>
<span class="sh">require &#39;rspec/autorun&#39;</span>

<span class="sh">Dir[Rails.root.join(&quot;spec/support/**/*.rb&quot;)].each {|f| require f}</span>

<span class="sh">RSpec.configure do |config|</span>
<span class="sh">  config.before(:suite) do</span>
<span class="sh">    DatabaseCleaner.strategy = :transaction</span>
<span class="sh">  end</span>

<span class="sh">  config.before(:each) do</span>
<span class="sh">    DatabaseCleaner.start</span>
<span class="sh">  end</span>

<span class="sh">  config.after(:each) do</span>
<span class="sh">    DatabaseCleaner.clean</span>
<span class="sh">  end</span>

<span class="sh">  config.include FactoryGirl::Syntax::Methods</span>
<span class="sh">end</span>
<span class="no">CODE</span>

<span class="n">file</span> <span class="s1">&#39;spec/factories.rb&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">FactoryGirl.define do</span>
<span class="sh">  # factory :demo do</span>
<span class="sh">  #   name &#39;name&#39;</span>
<span class="sh">  # end</span>
<span class="sh">end</span>
<span class="no">CODE</span>

<span class="n">file</span> <span class="s1">&#39;app/controllers/home_controller.rb&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">class HomeController &lt; ApplicationController</span>
<span class="sh">  def index</span>
<span class="sh">  end</span>
<span class="sh">end</span>
<span class="no">CODE</span>

<span class="n">file</span> <span class="s1">&#39;app/views/home/index.html.haml&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">%h1 Home#index</span>
<span class="sh">%p Find me in app/views/home/index.html.haml</span>
<span class="no">CODE</span>

<span class="n">file</span> <span class="s1">&#39;spec/controllers/home_controller_spec.rb&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">require &#39;spec_helper&#39;</span>

<span class="sh">describe HomeController do</span>
<span class="sh">  it &quot;index&quot; do</span>
<span class="sh">    get &#39;index&#39;</span>
<span class="sh">    response.should be_success</span>
<span class="sh">  end</span>
<span class="sh">end</span>
<span class="no">CODE</span>

<span class="n">head</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="s1">&#39;config/routes.rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="n">file_force</span> <span class="s1">&#39;config/routes.rb&#39;</span><span class="p">,</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
<span class="sh">#{head.strip}</span>
<span class="sh">  root to: &#39;home#index&#39;</span>
<span class="sh">end</span>
<span class="no">CODE</span>

<span class="no">FileUtils</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s1">&#39;public/index.html&#39;</span><span class="p">)</span>
<span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

<span class="nb">system</span> <span class="s2">&quot;bundle install&quot;</span>
<span class="nb">system</span> <span class="s2">&quot;rake db:create db:migrate db:test:prepare&quot;</span>
<span class="nb">system</span> <span class="s2">&quot;git init&quot;</span>
<span class="nb">system</span> <span class="s2">&quot;git add .&quot;</span>
<span class="nb">system</span> <span class="s2">&quot;git ci -amInitial&quot;</span>
</code></pre></div>
<p>Использую шаблон с помощью команды:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">./rails/railties/bin/rails new demo-app --edge -m rails-templates/edge-app.rb
</code></pre></div>
<p>По умолчанию будет использоваться рейлс из гитхаба <code>gem &#39;rails&#39;, github: &#39;rails/rails&#39;</code>, можно поменять вручную на <code>gem &#39;rails&#39;, path: &#39;../rails&#39;</code>, чтобы экспрериментировать со своими изменениями.</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vakhov-me'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        <div class="footer">
          <div class="contact">
            <img src="https://secure.gravatar.com/avatar/54e74983d81fa2fbe4c28e8392532f18" class="logo">
          </div>
          <div class="contact">
            <p>
              Alexey Vakhov<br>
              <a href=mailto:vakhov@gmail.com>vakhov@gmail.com</a>
            </p>
          </div>
          <div class="contact">
            <p>
              <img src="/images/twitter.ico"> - <a href="https://twitter.com/#!/avakhov">twitter</a><br>
              <img src="/images/github.ico"> - <a href="https://github.com/avakhov">github</a><br>
              <img src="/images/skype.ico"> - avakhov
            </p>
          </div>
          <div class="contact">
            <p>
              <img src="/images/instagram.ico"> - <a href="http://instagram.com/avakhov">instagram</a><br>
            </p>
          </div>
        </div>
      </div>
    </div> <!-- /container -->
  </body>
</html>
